<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™¾åº¦åœ°å›¾å·¥å…·è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç™¾åº¦åœ°å›¾å·¥å…·è°ƒè¯•</h1>
        
        <div>
            <h3>æµ‹è¯•åœ°ç‚¹æœç´¢</h3>
            <input type="text" id="query" placeholder="æœç´¢å…³é”®è¯" value="åŒ—äº¬å¤§å­¦">
            <input type="text" id="region" placeholder="åœ°åŒº" value="åŒ—äº¬">
            <button onclick="testLocationSearch()">æœç´¢åœ°ç‚¹</button>
        </div>
        
        <div>
            <h3>æµ‹è¯•è·¯çº¿è§„åˆ’</h3>
            <input type="text" id="origin" placeholder="èµ·ç‚¹" value="åŒ—äº¬è¥¿ç«™">
            <input type="text" id="destination" placeholder="ç»ˆç‚¹" value="åŒ—äº¬å¤§å­¦">
            <button onclick="testDirections()">è·å–è·¯çº¿</button>
        </div>
        
        <div>
            <h3>æµ‹è¯•å·¥å…·å£°æ˜</h3>
            <button onclick="testToolDeclarations()">æŸ¥çœ‹å¯ç”¨å·¥å…·</button>
        </div>
        
        <div id="log" class="log"></div>
    </div>

    <script type="module">
        import { ToolManager } from './src/static/js/tools/tool-manager.js';
        import { BaiduMapTool } from './src/static/js/tools/baidu-map-tool.js';

        const log = document.getElementById('log');
        
        function addLog(message) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        // æµ‹è¯•å·¥å…·ç®¡ç†å™¨
        const toolManager = new ToolManager();
        
        window.testLocationSearch = async function() {
            const query = document.getElementById('query').value;
            const region = document.getElementById('region').value;
            
            addLog(`å¼€å§‹æœç´¢: ${query} åœ¨ ${region}`);
            
            try {
                const baiduTool = new BaiduMapTool();
                const result = await baiduTool.execute({ query, region });
                
                if (result.results && result.results.length > 0) {
                    const first = result.results[0];
                    addLog(`âœ… æ‰¾åˆ°: ${first.name}`);
                    addLog(`ğŸ“ åœ°å€: ${first.address}`);
                    addLog(`ğŸ“ åæ ‡: ${first.location.lat}, ${first.location.lng}`);
                    addLog(`ğŸ“ ç”µè¯: ${first.telephone || 'æ— '}`);
                } else {
                    addLog('âŒ æœªæ‰¾åˆ°ç»“æœ');
                }
            } catch (error) {
                addLog(`âŒ é”™è¯¯: ${error.message}`);
            }
        };
        
        window.testDirections = async function() {
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            
            addLog(`å¼€å§‹è§„åˆ’è·¯çº¿: ${origin} â†’ ${destination}`);
            
            try {
                const baiduTool = new BaiduMapTool();
                const result = await baiduTool.execute({ 
                    origin: origin.includes(',') ? origin : origin, 
                    destination: destination.includes(',') ? destination : destination 
                });
                
                if (result.result && result.result.routes && result.result.routes.length > 0) {
                    const route = result.result.routes[0];
                    addLog(`âœ… è·¯çº¿ä¿¡æ¯:`);
                    addLog(`ğŸ“ è·ç¦»: ${route.distance}ç±³ (${(route.distance/1000).toFixed(1)}å…¬é‡Œ)`);
                    addLog(`â±ï¸ æ—¶é—´: ${Math.round(route.duration/60)}åˆ†é’Ÿ`);
                    addLog(`ğŸ›£ï¸ æ­¥éª¤æ•°: ${route.steps ? route.steps.length : 0}`);
                } else {
                    addLog('âŒ æœªæ‰¾åˆ°è·¯çº¿');
                }
            } catch (error) {
                addLog(`âŒ é”™è¯¯: ${error.message}`);
            }
        };
        
        window.testToolDeclarations = function() {
            addLog('ğŸ“‹ æŸ¥çœ‹å·¥å…·å£°æ˜...');
            const declarations = toolManager.getToolDeclarations();
            addLog(`ğŸ”§ å·¥å…·æ•°é‡: ${declarations[0].functionDeclarations.length}`);
            
            declarations[0].functionDeclarations.forEach((tool, index) => {
                addLog(`${index + 1}. ${tool.name}: ${tool.description}`);
            });
        };
        
        // åˆå§‹åŒ–æ—¶æ˜¾ç¤ºå·¥å…·ä¿¡æ¯
        addLog('ğŸš€ å·¥å…·è°ƒè¯•é¡µé¢å·²åŠ è½½');
        testToolDeclarations();
    </script>
</body>
</html>
